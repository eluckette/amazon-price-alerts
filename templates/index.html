{% extends 'base.html' %}
{% block content %}

<div class="jumbotron container-fluid">
	<div class="container">
		<div class="row">
			<div class="col-md-4">
				<div class="input-group">
					<div class="input-group-btn">
						<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Category <span class="caret"></span></button>
						<ul class="dropdown-menu" role="menu">
						<li><a href="#">All</a></li>
						<li><a href="#">Apparel</a></li>
						<li><a href="#">Beauty</a></li>
						<li><a href="#">Books</a></li>
						<li><a href="#">Electronics</a></li>
						<li><a href="#">Tools</a></li>
						<li><a href="#">Toys</a></li>
						</ul>
					</div>

					<input type="text" class="form-control" id="userSearch">

					<div class="input-group-btn">
						<button type="button" class="btn btn-default submitSearch"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
					</div>
				</div>
			</div>
		</div>

		<div class="row" id="rSearch">
			<div class="col-md-4">
				<a href="#" id="randomSearch">Random Search</a>
			</div>
		</div>
	</div>
</div>

<div class="container">
	<div class="row">
		<h4>See what others are setting alerts for</h4>
		<table class="table" id="otherAlerts">
			<tr>
			</tr>
		</table>
	</div>
</div>

<script>
	$(document).ready(function() {
		getOtherAlerts()
		$("#randomSearch").on("click", getRandomSearch);
	});

	function getRandomSearch() {
		$.get("/get-random-search", function(results){
			console.log(results);
			return results;
		});
	}

	function getOtherAlerts() {
		$.get("/get-other-alerts", function(results){
			insertOtherAlerts(results);
		});
	}

	function insertOtherAlerts(results) {
		var table = document.getElementById("otherAlerts");
		var row = table.insertRow(1);
		var arrAlerts = [];

		for (alert in results) {
			for (var i = 0; i < results[alert].length; i++) {
				arrAlerts.push({
					title: results[alert][i].Title,
					image_url: results[alert][i].Image_URL
				});
			};
		};
		
		arrAlerts = randomizeArray(arrAlerts);
		function randomizeArray(array) {
			var i = array.length, j, temp;

			while (--i >= 1) {
				j = Math.floor(Math.random()*(i + 1));
				temp = array[i];
				array[i] = array[j];
				array[j] = temp;
			}
			return array;
		}

		for (var i = 0; i < 6; i++) {
			var homeCell = row.insertCell(0);
			homeCell.innerHTML = "<img src='"+arrAlerts[i].image_url+"'</p>"+
							     "<p>"+arrAlerts[i].title+"</p>";
		}


	}

	$(".dropdown-menu li a").click(function(){
		  $(this).parents(".input-group-btn").find('.btn').text($(this).text());
		  $(this).parents(".input-group-btn").find('.btn').val($(this).text());
	});

	function sendSearch(evt) {
		var category = $(".dropdown-menu").parents(".input-group-btn").find(".btn").val();
		var userSearch = $("#userSearch").val();

		var form = document.createElement("form");
		var inputCategory = document.createElement("input");
		var inputSearch = document.createElement("input");

		$(form).attr("action", "/search-results");

		$(inputCategory).attr("value", category);
		$(inputCategory).attr("name", "category");

		$(inputSearch).attr("value", userSearch);
		$(inputSearch).attr("name", "user_input");

		form.appendChild(inputCategory);
		form.appendChild(inputSearch);

		form.submit();
	}
	$(".submitSearch").on("click", sendSearch);
</script>
{% endblock %}
