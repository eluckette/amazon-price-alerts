{% extends 'base.html' %}
{% block content %}

<div class="container">
	<div class="row">
		<div id="user">
		</div>
	</div>

	<div class="row">
		<div class="col-md-6" id="alerts">
			<h3>Current Alerts</h3>
			<table class="table table-hover" id="alertTable">
				<tr>
					<th></th>
					<th>Product</th>
					<th>Alert Price</th>
					<th>Expiration Date</th>
				</tr>
			</table>
		</div>

		<div class="col-md-1">
		</div>


		<div class="col-md-4" id="prevViewed">
			<h3>Recent Searches</h3>
			<table class="table" id="userSearchesTable">
				<tr>
				</tr>
			</table>
		</div>
	</div>

</div>

<script>
	$(document).ready(function() {
		getAccountInfo()
	});

	function getAccountInfo() {
		$.get("/get-current-alerts", function(results){
			insertAlerts(results);
		});

		$.get("/get-user-searches", function(results){
			insertSearches(results);
		});
	}

	function insertAlerts(results) {	
	    var table = document.getElementById("alertTable");
		for (alert in results) {
			for (i = 0; i < results[alert].length; i++) {
				var row = table.insertRow(1);
				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);	
				var cell3 = row.insertCell(2);
				var cell4 = row.insertCell(3);
				cell1.innerHTML = "<button class='btn btn-default delItem' data-alert_id='"+results[alert][i].Alert_id+"'>Delete</button>";
				cell2.innerHTML = "<p>"+results[alert][i].Title+"</p>";
				cell3.innerHTML = "<p>"+formatNumber(results[alert][i].Alert_price)+"</p>";
				cell4.innerHTML = "<p>"+results[alert][i].Expiration_date+"</p>";	

				function formatNumber(num) {
					 return "$" + num.toFixed(2).replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
				};	
			};
		};
	}


	function insertSearches(results) {
		var table = document.getElementById("userSearchesTable");
		for (alert in results) {
			for (i = 0; i < 2; i++) {
				var row = table.insertRow(1);
				var cell1 = row.insertCell(0);
				cell1.innerHTML = "<p><img src='"+results[alert][i].Image_URL+"'</p>"+
								  "<p>"+results[alert][i].Title+"</p>";		
			};
		};
	}

	function deleteItem(evt) {
		var data = $(this).data();
		
		$.post("/delete-alert", 
			{alert_id: data.id}, 

			function (result) {
				return "ok"
		});
	}

	$("#delItem").on("click", deleteItem);
</script>

{% endblock %}
